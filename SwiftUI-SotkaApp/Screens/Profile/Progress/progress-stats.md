# Статистика прогресса - реализовано ✅

## Обзор
Горизонтальная вьюха с визуализацией статистики пользователя: активность, инфопосты и полный прогресс в процентах.

## Компоненты
- **ProgressStatsView** - основная вьюха статистики
- **ProgressBarView** - горизонтальный прогресс-бар с 100 сегментами
- **ProgressStatsLabelsView** - лейблы с процентами
- **ProgressCalculator** - логика расчета по инфопостам и активностям

## Статусы дней
- **currentDay** (синий) - текущий день программы
- **completed** (зеленый) - активность + инфопост
- **partial** (желтый) - только активность ИЛИ только инфопост
- **skipped** (красный) - день в пределах программы, но нет активности и инфопоста
- **notStarted** (серый) - день еще не начался (будущие дни)

## Логика расчета
- **Полный прогресс**: дни с активностью И прочитанным инфопостом
- **Инфопосты**: дни с прочитанным инфопостом
- **Активность**: дни с любой активностью (workout, stretch, rest, sick)

## Анализ работы с ежедневной активностью в старых приложениях

### 1. Где сохраняются данные ежедневной активности?

#### Старое iOS приложение (SOTKA-OBJc)
- **Локальное хранение**: Core Data с моделью `DbDay`
- **Структура данных**: 
  - `day` (номер дня)
  - `activityType` (тип активности: тренировка=0, отдых=1, растяжка=2, болезнь=3)
  - `cycleCount` (количество кругов)
  - `executeType` (тип выполнения)
  - `trainType` (тип тренировки)
  - `synched` (флаг синхронизации)
  - `shouldDelete` (флаг удаления)
  - `createDate`, `modifyDate` (даты создания и изменения)

#### Android приложение (Android-SOTKA)
- **Локальное хранение**: SQLite через Room с моделью `Day`
- **Структура данных**:
  - `dayNumber` (номер дня)
  - `activityType` (enum: TRAINING, STRETCHING, REST, SICK, DELETED)
  - `passed` (флаг прохождения)
  - `actualCircles` (фактическое количество кругов)
  - `synced` (флаг синхронизации)
  - `comment` (комментарий)

### 2. Отправляются ли данные на сервер или хранятся только локально?

#### Старое iOS приложение
- **Офлайн-приоритет**: Данные сохраняются локально в Core Data
- **Синхронизация**: Опциональная, через `SyncManager`
- **API endpoints**: 
  - `POST 100/days` - загрузка нового дня
  - `POST 100/days/{dayNumber}` - изменение существующего дня
  - `DELETE 100/days/{dayNumber}` - удаление дня
- **Флаги синхронизации**: `synched = NO` при создании/изменении, `synched = YES` после успешной отправки

#### Android приложение
- **Офлайн-приоритет**: Данные сохраняются локально в SQLite
- **Синхронизация**: Опциональная, через `SyncInteractor`
- **API endpoints**: Аналогичные iOS приложению
- **Флаги синхронизации**: `synced = false` при создании/изменении, `synced = true` после успешной отправки

### 3. В какой момент сохраняются данные?

#### Старое iOS приложение
- **Немедленное сохранение**: При выборе типа активности (тренировка, отдых, растяжка, болезнь)
- **Создание записи**: `DbDay` создается с текущей датой и `synched = NO`
- **Обновление UI**: Через `ModelChangeNotification` после сохранения

#### Android приложение
- **Немедленное сохранение**: При выборе типа активности через `updateDayInDatabase()`
- **Создание записи**: `Day` создается с `synced = false`
- **Обновление UI**: Через RxJava Observable потоки

### 4. Можно ли редактировать данные?

#### Старое iOS приложение
- **Редактирование**: Да, через `editCurrentDay()` в `HomeController`
- **Удаление**: Да, через `markAsDeleted()` с флагом `shouldDelete = YES`
- **Изменение типа активности**: Да, через методы `rest()`, `stretch()`, `sick()`

#### Android приложение
- **Редактирование**: Да, через `editClicked()` в `TrainingsPresenter`
- **Удаление**: Да, через `makeDayNotPassed()` с `activityType = DELETED`
- **Изменение типа активности**: Да, через `activityTypeSelected()`

### 5. Обновляется ли статистика при редактировании данных?

#### Старое iOS приложение
- **Обновление модели**: Да, через `[model reload]` в `DiaryModel`
- **Уведомления**: `ModelChangeNotification` для обновления UI
- **Пересчет статистики**: Автоматически при изменении данных в Core Data

#### Android приложение
- **Обновление списка**: Да, через `updateDayInList()` в `MainViewModel`
- **RxJava потоки**: Автоматическое обновление через Observable
- **Пересчет статистики**: Автоматически при изменении данных в SQLite

### 6. В какой момент день считается skipped?

#### Старое iOS приложение
- **Логика определения**: День считается пропущенным, если:
  - Номер дня меньше текущего дня программы
  - Нет записи в Core Data для этого дня (`[DbDay fetchDay:dayNumber]` возвращает `nil`)
  - Или есть запись с `shouldDelete = YES`
- **Момент определения**: При открытии приложения и расчете текущего дня через `WorkOutBrain.currentDay`

#### Android приложение
- **Логика определения**: День считается пропущенным, если:
  - Номер дня меньше текущего дня программы
  - Нет записи в SQLite для этого дня (`daysDao.getSingleDay(dayNumber)` возвращает ошибку)
  - Или есть запись с `activityType = DELETED`
- **Момент определения**: При открытии приложения и расчете текущего дня через `DaySwitcher.getCurrentDay()`

### Ключевые выводы для нового приложения

1. **Офлайн-приоритет**: Оба приложения работают полностью офлайн с опциональной синхронизацией
2. **Немедленное сохранение**: Данные сохраняются сразу при выборе активности
3. **Флаги синхронизации**: Обязательны для отслеживания статуса синхронизации
4. **Редактирование**: Полная поддержка редактирования и удаления записей
5. **Автоматическое обновление**: Статистика пересчитывается автоматически при изменении данных
6. **Skipped дни**: Определяются как дни без активности в пределах программы
