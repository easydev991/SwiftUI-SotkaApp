---
name: offline-priority
description: Правила офлайн-приоритета для SotkaApp
---
# Офлайн-приоритет (критически важно!)

## Когда применять

- При разработке любой функции, работающей с данными
- При создании новых моделей SwiftData
- При реализации синхронизации с сервером
- При работе с сетевыми запросами
- При создании UI для отображения данных

## Основные принципы

### 1. Офлайн-работа как приоритет

- **Приложение должно работать полностью офлайн** без интернета
- **Все данные сохраняются локально** в SwiftData с флагом синхронизации
- **Синхронизация с сервером** происходит только при наличии интернета и авторизованного пользователя
- **Синхронизация не блокирует** основную функциональность приложения
- **Приоритеты разработки**: 1) Локальное сохранение в SwiftData, 2) Синхронизация с сервером (если есть интернет и сервер отвечает на запросы), 3) Никогда не блокировать UI ожиданием синхронизации

#### Исключение для авторизации

- **Если пользователь решил авторизоваться** с использованием логина и пароля, то пока он успешно не авторизуется, мы не показываем главный экран и блокируем UI (как уже реализовано)
- **Ждем первую успешную синхронизацию** для авторизованного пользователя
- **После первой успешной синхронизации** для авторизованного пользователя на первом месте ставим офлайн-работу, а синхронизацию - на второе место (чтобы не блокировало UI)

### 2. Флаги синхронизации для всех моделей

См. примеры использования в [references/EXAMPLE.md](references/EXAMPLE.md).

### 3. Паттерны офлайн-работы

- **Сначала** сохраняй локально в SwiftData
- **Потом** пытайся синхронизировать с сервером
- **При ошибке** синхронизации - продолжай работу локально
- **Показывай** статус синхронизации пользователю
- **Никогда не блокируй** UI ожиданием синхронизации

### 4. Примеры реализации

См. примеры в [references/EXAMPLE.md](references/EXAMPLE.md).

### 5. Правила для Cursor

#### При создании новых функций

1. **Всегда** реализуй локальное сохранение в SwiftData
2. **Добавляй** флаги синхронизации (`isSynced`, `shouldDelete`)
3. **Синхронизацию** делай опциональной и неблокирующей
4. **Тестируй** работу без интернета

#### При работе с данными

1. **Сначала** сохраняй локально в SwiftData
2. **Потом** пытайся синхронизировать с сервером
3. **При ошибке** синхронизации - продолжай работу локально
4. **Показывай** статус синхронизации пользователю

#### При создании UI

1. **Не блокируй** UI ожиданием синхронизации
2. **Показывай** индикатор синхронизации отдельно
3. **Работай** с локальными данными из SwiftData
4. **Обновляй** UI при получении данных с сервера

### 6. Тестирование

- **Тестируй** все функции без интернета
- **Проверяй** сохранение данных локально
- **Тестируй** синхронизацию при появлении интернета
- **Проверяй** обработку ошибок синхронизации

### 7. Пользовательский опыт

- **Приложение работает** без интернета
- **Данные сохраняются** локально
- **Синхронизация** происходит в фоне
- **Пользователь видит** статус синхронизации
- **При ошибке** синхронизации - работа продолжается

## Заключение

SotkaApp должен быть **офлайн-первым** приложением, где синхронизация с сервером является дополнительной функцией, а не обязательной для работы приложения. Пользователь должен иметь возможность полноценно использовать приложение без интернета.
